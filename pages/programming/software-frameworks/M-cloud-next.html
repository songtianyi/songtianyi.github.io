<!DOCTYPE html>
<html>
<head>
<title>M-cloud-next.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%E5%AE%B9%E5%99%A8-%E4%BA%91%E8%AE%A1%E7%AE%97%E7%9A%84%E4%B8%8B%E4%B8%80%E6%AD%A5">容器: 云计算的下一步</h1>
<p>作者: <a href="http://www.songtianyi.info">songtianyi</a> 本文中的大部分内容整理自互联网，如有侵权，请联系本人删除。</p>
<h5 id="%E5%89%8D%E8%A8%80">前言</h5>
<p>云，已是企业 IT 的基本形态。以欧洲和美国为例，截止到 2019 年第一季度，IaaS 平台的覆盖率为 49%。随着企业逐步上云，借助云平台，我们解决了硬件资源的管理和交付的难题，解放了基础运维人员。但应用开发和应用运维人员可能觉得上云前和上云后区别并不大，应用的交付和运维还是很困难。这是一个必须要克服的困难。为什么呢？</p>
<h5 id="%E6%95%B0%E5%AD%97%E5%8C%96%E8%BD%AC%E5%9E%8B">数字化转型</h5>
<p>答案是，被逼的，被数字化转型逼的，被市场逼的。数字化转型是指利用现代技术和通信手段，改变企业为客户创造价值的方式。比如，银行推出自己的手机 APP，改变服务方式。数字化的浪潮从互联网诞生之时就已经开始了，近年来，随着互联网技术的演进，大数据，人工智能，区块链，物联网等等，新的概念层出不穷，为了能够跟上节奏，企业 IT 不得不进行持续的革新，从而保证资源的交付效率和应用的交付效率，以及客户体验等等，进而保证企业在浪潮中不会掉队。例如，如果你的 APP 交易速度比别人慢，就很有可能会被市场淘汰。做完云基础设施的建设也不保证企业能够高枕无忧。如何克服？目前答案已经很明确了 ，容器。2013 年 docker 发布，拉开了基于容器技术的 IT 变革序幕，容器或者说 docker(容器的事实标准)，以及容器管理平台，如 kubernetes，已经深刻改变了应用交付和运维方式。</p>
<h5 id="%E5%AE%B9%E5%99%A8%E7%AE%80%E5%8F%B2">容器简史</h5>
<ol>
<li><strong>Unix 版本 7</strong>在开发过程中引入<strong>Chroot Jail</strong>以及 Chroot 系统调用。Chroot jail 被用于“Change Root”，它被认为是最早的容器化技术之一。它允许将进程及其子进程与操作系统的其余部分隔离开来。这种隔离的唯一问题是根进程（root process）可以轻松地退出 chroot, 未实现安全机制。<strong>FreeBSD Jail</strong>于 2000 年在 FreeBSD OS 中引入，旨在为简单的 Chroot 文件隔离带来更多安全性。与 Chroot 不同，FreeBSD 还实现了将进程及其活动隔离到文件系统的特定视图中。比如，你可以将一个 qcow2 镜像文件挂载到 linux 系统中，使用 chroot 将根目录切换到镜像文件的系统根目录，并运行程序，程序所读写的文件都是镜像文件，host 系统的文件都被隔离开了。但 chroot 机制不能限制系统资源的使用，如 I/O, CPU, 内存。</li>
<li>当 Linux 内核具有操作系统级的虚拟化的功能以后，<strong>Linux VServer</strong>于 2001 年被推出，它使用了类似 chroot 的机制与“安全上下文”（“security context”）以及操作系统虚拟化（容器化）相结合来提供虚拟化解决方案。它比简单的 chroot 更先进，允许您在单个 Linux 发行版（VPS）上运行多个 Linux 发行版。</li>
<li>2005 年，<strong>OpenVZ</strong>的第一个版本推出。OpenVZ 与 Linux-VServer 一样，使用操作系统级虚拟化，许多托管公司采用它来隔离和销售 VPS。操作系统级虚拟化有一些限制，因为容器共享相同的体系结构和内核版本，当客户需要不同于主机的内核版本的情况下这种缺点就会显现出来。</li>
<li>2007 年，谷歌发布了<strong>CGroups</strong>，这是一种机制，这种机制能限制和隔离一系列进程的资源使用（CPU，内存，磁盘 I / O，网络等）。与 OpenVZ 内核相反，CGroups 在 2007 年集成进了 Linux 内核。</li>
<li>2008 年，**LXC（Linux containers，Linux 容器）**的第一个版本发布。LXC 与 OpenVZ，Solaris Containers 和 Linux-VServer 类似，但是它使用的是已经在 Linux 内核中实现的 CGroup。</li>
<li>2013 年，<strong>Docker</strong>推出了的第一个版本。它像 OpenVZ 一样，实现操作系统级虚拟化。</li>
</ol>
<h5 id="%E5%AE%B9%E5%99%A8%E5%A4%A7%E6%88%98">容器大战</h5>
<p>docker 发布之后便迅速占领市场，吸引了一众厂商参与，包括云计算的领头羊 amazon，google，ibm，微软等。docker 在构建，交付和运行分布式应用方面具有无可比拟的优势。彼时，云计算方兴未艾，硬件虚拟化(hardware-level-virtualization)占统治地位，docker 的发布让大家看到了大规模操作系统级虚拟化(os-level-virtualization)的可能性，为了不在云计算领域掉队，接受并参与 docker 是最好的选择。另一方面，IT 基础设施和应用架构在发生变化。企业上云的过程中，基础环境变得复杂，有的服务跑在硬件物理机上，有的跑在虚拟机上，既有本地数据中心，又有灾备数据中心; 在互联网时代，为了实现应用的快速开发迭代，和更好的弹性伸缩，互联网应用不再采用传统的三层架构，而是使用微服务的方式来实现软件系统的松耦合，因此应用的数量成倍地增长，给应用的交付带来巨大压力。因此，docker 的诞生适逢其时。docker 发布之后，coreos 成为其第二大贡献者，不久之后 coreos 和 docker 决裂，转而发布了 Rocket，docker 并没有什么硬伤，加上先入为主，Rocket 最终完败。在 PaaS 方面，2014 年 6 月 6 号，Google 发布了 kubernetes，并拉了 RedHat 参与，RedHat 基于 kubernetes 开发了企业级 kubernetes 平台 openshift；2014 年 12 月，docker 发布 swarm 项目；2015 年，Mesosphere 发布了基于 mesos 的 Marathon 项目。混战持续至 2017 年，最终 kubernetes 一统天下，docker 公司在自己的企业版 docker 中内置了 kubernetes。</p>
<h5 id="%E8%BD%AF%E4%BB%B6%E4%BA%A4%E4%BB%98%E9%9D%A9%E6%96%B0">软件交付革新</h5>
<p>docker 项目发布时, 也是 LXC 的一个使用者，在容器方面和 CloudFoundry 并没有本质区别，属于组合式创新。但 docker 有一个杀手锏，那就是容器镜像。docker image 直接将应用所需的运行环境即操作系统也打包了进去，解决了运行环境的一致性问题，要知道维护一两台机器的一致性和几万台机器的一致性可是完全不同的，这种问题如果没有完善的监控是很难 debug 的; docker image 可以在任何支持 docker 的 linux 发行版上运行，屏蔽了系统间的差异; 镜像仓库解决了镜像在分布式环境的分发问题; 镜像引入了分层，commit 的概念，保证了分发的效率。最终，软件的交付形式由二进制/脚本变成了镜像。</p>
<h5 id="%E6%B8%97%E9%80%8F">渗透</h5>
<p>docker 的诞生，让 PaaS 迎来了第二春，docker 体系是以“单一容器”为核心的应用定义方式，应用的生命周期管理都是基于单个容器的，而我们交付给用户的往往是一组容器，这些容器在分布式环境下的网络互通及隔离问题，存储怎么共享，docker 都没能给出答案。虽然 docker 引入了 docker-compose 来解决容器编排的问题，但面对大规模的分布式应用，docker-compose 仍然显得捉襟见肘。最终，基于 docker 平台的 kubernetes 在 Google 近十年的容器化基础设施方面的经验的加持下，取得了最终的领导地位，奠定了容器化基础设施的标准。kubernetes 对容器编排以及网络，存储进行更高层次的抽象，提供插件式的支持方案，以及它的声明式 API 重新定义了云时代的“应用”的概念，对于 kubernets 来说，应用是一组容器的有机组合，同时也包括了应用运行所需的网络／存储的需求描述。从而，docker 从软件交付渗透到了应用的定义，编排，交付及管理这一更高层次，成为基础设施中的基石。docker 的诞生还催生了 FAAS 这一新的生态，比较典型的例子是 aws 的 lambda, docker 和 kubernetes 可以让我们把更多的精力放在业务逻辑而不是应用的交付及运维上，而 FAAS 则完全无需关心应用的交付及运维。</p>
<h5 id="%E7%84%A6%E8%99%91">焦虑</h5>
<p>最近 ETC 营销大战的新闻大家应该有所耳闻，各个银行绞尽脑汁地去亏本获客，说明传统金融行业在 2013 年被余额宝打蒙之后已经缓过神来了，已经具备了一定的互联网思维。在这个不进则退的时代，面对互联网技术日新月异的变化，传统金融公司由于包袱重，反应稍显迟钝，会产生掉队的焦虑。消除焦虑最好的方式是去了解和跟踪这些技术，可以成立专门的部门来负责技术的调研和落地。</p>

</body>
</html>
